<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>RxJS Github User Search</title>
    <script src="../node_modules/rxjs/dist/bundles/rxjs.umd.js"></script>
    <style>
      .autocomplete {
        position: relative;
        width: 300px;
      }
      #search {
        width: 100%;
      }
      #suggestLayer {
        position: absolute;
        top: 20px;
        color: #666;
        padding: 0;
        margin: 0;
        width: 100%;
      }
      #suggestLayer li {
        border: 1px solid #bec8d8;
        list-style: none;
      }
      .user img {
        position: relative;
        float: left;
        margin-right: 10px;
      }
      .user p {
        line-height: 50px;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div class="autocomplete">
      <input id="search" type="text" placeholder="Search Github Users" />
      <ul id="suggestLayer"></ul>
    </div>
    <script>
      const $layer = document.getElementById("suggestLayer");

      const drawLayer = (items) => {
        $layer.innerHTML = items
          .map(({ avatar_url, html_url, login }) => {
            return `<li class="user">
<img src="${avatar_url}" width="50px" height="50px" alt="avatar"/>
<p><a href="${html_url}" target="_blank">${login}</a></p>
</li>`;
          })
          .join("");
      };

      const { fromEvent } = rxjs;
      const { map, mergeMap, debounceTime, filter, distinctUntilChanged } =
        rxjs.operators;
      const { ajax } = rxjs.ajax;
      const user$ = fromEvent(document.getElementById("search"), "keyup").pipe(
        debounceTime(300),
        map((event) => event.target.value),
        distinctUntilChanged(),
        filter((query) => query.trim().length > 0),
        mergeMap((query) =>
          ajax.getJSON(`https://api.github.com/search/users?q=${query}`)
        )
      );

      user$.subscribe(({ items }) => {
        drawLayer(items);
      });
    </script>
  </body>
</html>
